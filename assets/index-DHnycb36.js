(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function i(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(t){if(t.ep)return;t.ep=!0;const s=i(t);fetch(t.href,s)}})();const T=(l,e)=>({x:v(0,l-1),y:v(0,e-1)}),v=(l,e)=>{if(l>e)throw new Error("start > end");return l=Math.round(l),e=Math.round(e),Math.floor(Math.random()*(e-l+1))+l},w=parseFloat(getComputedStyle(document.documentElement).fontSize),E=l=>l*w,A=async l=>{await new Promise(e=>setTimeout(e,l))},y="/demineur-web/assets/tile-default-Dh8Q20LU.png",M="/demineur-web/assets/tile-open-0-CrS4pPc-.png",P="/demineur-web/assets/tile-open-1-SckrNgAq.png",C="/demineur-web/assets/tile-open-2-CbT6ZeWw.png",L="/demineur-web/assets/tile-open-3-CiFI3eKm.png",F="/demineur-web/assets/tile-open-4-BtNOdLHl.png",k="/demineur-web/assets/tile-open-5-LlQTJ3PK.png",G="/demineur-web/assets/tile-open-6-BtQkAIJT.png",R="/demineur-web/assets/tile-open-7-CFmK46RT.png",B="/demineur-web/assets/tile-open-8-CXyNsnO6.png",N="/demineur-web/assets/tile-flag-DK9cqpkC.png",_="/demineur-web/assets/tile-flag-not-sure-B-KW3eDb.png",f="/demineur-web/assets/tile-flag-no-mine-Cm0K1Zw-.png",U="/demineur-web/assets/tile-mine-CRq_55oK.png",D="/demineur-web/assets/tile-mine-boom-CLZgeeVb.png",S="/demineur-web/assets/tile-shovel-xsDt0QN9.png",$="/demineur-web/assets/tile-cross-DyPziB2I.png";class H{_minefield;_mine;_state;_position;_htmlElement;_isPopupOpen;constructor(e,i,n){this._minefield=e,this._position=i,this._mine=n,this._state="DEFAULT",this._htmlElement=document.createElement("div"),this._htmlElement.id=`tile-${this.position.x}-${this.position.y}`,this._isPopupOpen=!1}get minefield(){return this._minefield}get position(){return this._position}get mine(){return this._mine}set mine(e){this._mine=e}get state(){return this._state}set state(e){this._state=e}get isPopupOpen(){return this._isPopupOpen}set isPopupOpen(e){this._isPopupOpen=e}get numberOfMinesAround(){return this.mine?0:this.minefield.getNumberOfMinesAround(this.position)}get numberOfFlagsAround(){return this.mine?0:this.minefield.getNumberOfFlagsAround(this.position)}get numberOfUnexploredTilesAround(){return this.minefield.getNumberOfUnexploredTilesAround(this.position)}get htmlElement(){return this._htmlElement}openPopup(){if(this.isPopupOpen||this.minefield.isGameOver||this.state==="OPEN"&&this.numberOfMinesAround===0)return;this.minefield.closeAllOtherPopup(this.position);const e=document.createElement("div");if(e.className="dig-popup",this.state==="DEFAULT"||this.state==="OPEN"&&this.numberOfUnexploredTilesAround>0){const t=document.createElement("button"),s=document.createElement("img");s.src=S,s.alt="Dig",t.appendChild(s),t.type="button",t.title="Dig",t.onclick=()=>this.open(),e.appendChild(t)}if(this.state!=="OPEN"){const t=document.createElement("button");if(this.state==="FLAG"){const r=document.createElement("img");r.src=f,r.alt="Remove the flag.",t.appendChild(r),t.type="button",t.title="Remove the flag.",t.onclick=()=>{this.state="DEFAULT",this.closePopup(),this.minefield.updateNumberOfMinesRemainingIndicator()}}else{const r=document.createElement("img");r.src=N,r.alt="Put a flag here.",t.appendChild(r),t.type="button",t.title="Put a flag here.",t.onclick=()=>{this.state="FLAG",this.closePopup(),this.minefield.updateNumberOfMinesRemainingIndicator()}}e.appendChild(t);const s=document.createElement("button");if(this.state==="FLAG-NOT-SURE"){const r=document.createElement("img");r.src=f,r.alt="Remove the flag.",s.appendChild(r),s.type="button",s.title="Remove the flag.",s.onclick=()=>{this.state="DEFAULT",this.closePopup()}}else{const r=document.createElement("img");r.src=_,r.alt="Put a flag with a question mark here.",s.appendChild(r),s.type="button",s.title="Put a flag with a question mark here.",s.onclick=()=>{this.state="FLAG-NOT-SURE",this.closePopup()}}e.appendChild(s)}const i=document.createElement("button"),n=document.createElement("img");n.src=$,n.alt="Close popup",i.appendChild(n),i.type="button",i.title="Close popup",i.onclick=()=>this.closePopup(),e.appendChild(i),this.htmlElement.appendChild(e),this.isPopupOpen=!0}closePopup(){this.isPopupOpen&&(this.render(),this.isPopupOpen=!1)}open(){this.minefield.isGameOver||(this.minefield.firstClick&&this.minefield.handleFirstClick(this.position),this.state="OPEN",this.mine?this.minefield.gameOver(!1):(this.minefield.checkIfItsAWin(),this.numberOfFlagsAround===this.numberOfMinesAround&&this.minefield.openAdjacentTiles(this.position)),this.render())}render(){this.htmlElement.innerHTML="",this.htmlElement.className=`tile ${this.state.toLowerCase()} ${this.state!=="OPEN"||this.numberOfUnexploredTilesAround>0?"can-dig":""}`;let e=y,i="";this.minefield.isGameOver&&this.mine&&this.state==="DEFAULT"?(e=U,i="Mine"):this.minefield.isGameOver&&!this.mine&&(this.state==="FLAG"||this.state==="FLAG-NOT-SURE")?(e=f,i="There were no mines here."):this.state==="DEFAULT"?(e=y,i="Unexplored"):this.state==="FLAG"?(e=N,i="Flag"):this.state==="FLAG-NOT-SURE"?(e=_,i="There may be a mine."):this.mine?(e=D,i="A mine exploded here."):this.numberOfMinesAround===0?(e=M,i="No mines nearby."):this.numberOfMinesAround===1?(e=P,i="1 mine nearby."):this.numberOfMinesAround===2?(e=C,i="2 mines nearby."):this.numberOfMinesAround===3?(e=L,i="3 mines nearby."):this.numberOfMinesAround===4?(e=F,i="4 mines nearby."):this.numberOfMinesAround===5?(e=k,i="5 mines nearby."):this.numberOfMinesAround===6?(e=G,i="6 mines nearby."):this.numberOfMinesAround===7?(e=R,i="7 mines nearby."):this.numberOfMinesAround===8&&(e=B,i="8 mines nearby.");const n=document.createElement("img");n.src=e,n.alt=i,n.title=i,n.onclick=()=>{this.minefield.firstClick?this.open():this.openPopup()},this.htmlElement.appendChild(n)}}class z{_htmlElement;_container;_timer;_tiles;_isGameOver;_won;_firstClick;_numberOfMinesRemainingIndicator;constructor(e,i,n,t){this._htmlElement=e,this._container=i,this._tiles=[],this._isGameOver=!1,this._won=!1,this._firstClick=!0,this._timer=n,this._numberOfMinesRemainingIndicator=t}get htmlElement(){return this._htmlElement}get container(){return this._container}get timer(){return this._timer}get numberOfMinesRemainingIndicator(){return this._numberOfMinesRemainingIndicator}get tiles(){return this._tiles}set tiles(e){this._tiles=e}get width(){return this.tiles[0].length}get height(){return this.tiles.length}get isGameOver(){return this._isGameOver}set isGameOver(e){this._isGameOver=e}get won(){return this._won}set won(e){this._won=e}get firstClick(){return this._firstClick}set firstClick(e){this.firstClick&&!e&&this.timer.start(),this._firstClick=e}get numberOfMinesRemaining(){let e=0,i=0;for(const n of this.tiles)for(const t of n)t.state==="FLAG"&&i++,t.mine&&e++;return e-i}newGame(e,i,n){if(n>e*i-9)throw new Error("To much mine");const t=[];for(let s=0;s<n;s++){let r,u;do{u=!0,r=T(e,i);for(const d of t)if(d.x===r.x&&d.y===r.y){u=!1;break}}while(!u);t.push(r)}this.timer.reset(),this.isGameOver=!1,this.won=!1,this.firstClick=!0,this.tiles=[];for(let s=0;s<i;s++){const r=[];for(let u=0;u<e;u++){let d=!1;for(const O of t)if(O.x===u&&O.y===s){d=!0;break}r.push(new H(this,{x:u,y:s},d))}this._tiles.push(r)}this.htmlElement.innerHTML="";for(const s of this.tiles){const r=document.createElement("div");r.className="tile-line";for(const u of s)r.appendChild(u.htmlElement);this.htmlElement.appendChild(r)}this.updateNumberOfMinesRemainingIndicator(),this.render(),(async()=>(A(0),this.resize(this.container.clientWidth,this.container.clientHeight)))()}updateNumberOfMinesRemainingIndicator(){this.numberOfMinesRemainingIndicator.innerText=this.numberOfMinesRemaining.toString()}handleFirstClick(e){this.firstClick=!1;let i=0;for(let n=e.y-1;n<=e.y+1;n++)for(let t=e.x-1;t<=e.x+1;t++)t<0||n<0||t>this.tiles[0].length-1||n>this.tiles.length-1||this.tiles[n][t].mine&&(i++,this.tiles[n][t].mine=!1);for(let n=0;n<i;n++){let t,s;do s=!0,t=T(this.tiles[0].length,this.tiles.length),(t.x>=e.x-1&&t.x<=e.x+1&&t.y>=e.y-1&&t.y<=e.y+1||this.tiles[t.y][t.x].mine)&&(s=!1);while(!s);this.tiles[t.y][t.x].mine=!0}}gameOver(e){this.timer.stop(),this.isGameOver=!0,this.won=e,this.render()}checkIfItsAWin(){if(this.isGameOver)return;let e=0,i=0;for(const n of this.tiles)for(const t of n)t.state!=="OPEN"&&i++,t.mine&&e++;e===i&&this.gameOver(!0)}getNumberOfMinesAround(e){let i=0;for(let n=e.y-1;n<=e.y+1;n++)for(let t=e.x-1;t<=e.x+1;t++)t===e.x&&n===e.y||t<0||n<0||t>this.tiles[0].length-1||n>this.tiles.length-1||this.tiles[n][t].mine&&i++;return i}getNumberOfFlagsAround(e){let i=0;for(let n=e.y-1;n<=e.y+1;n++)for(let t=e.x-1;t<=e.x+1;t++)t===e.x&&n===e.y||t<0||n<0||t>this.tiles[0].length-1||n>this.tiles.length-1||this.tiles[n][t].state==="FLAG"&&i++;return i}getNumberOfUnexploredTilesAround(e){let i=0;for(let n=e.y-1;n<=e.y+1;n++)for(let t=e.x-1;t<=e.x+1;t++)t===e.x&&n===e.y||t<0||n<0||t>this.tiles[0].length-1||n>this.tiles.length-1||this.tiles[n][t].state==="DEFAULT"&&i++;return i}openAdjacentTiles(e){for(let i=e.y-1;i<=e.y+1;i++)for(let n=e.x-1;n<=e.x+1;n++)n===e.x&&i===e.y||n<0||i<0||n>this.tiles[0].length-1||i>this.tiles.length-1||this.tiles[i][n].state!=="DEFAULT"||this.tiles[i][n].open()}closeAllOtherPopup(e){for(const i of this.tiles)for(const n of i)n.position.x===e.x&&n.position.y===e.y||n.closePopup()}render(){this.htmlElement.className=this.isGameOver?"game-over":"";for(const e of this.tiles)for(const i of e)i.render()}resize(e,i){const n=e/i,t=this.width/this.height;n>t?this.htmlElement.style=`--tile-size: ${i/this.height-E(5)/this.height}px;`:this.htmlElement.style=`--tile-size: ${e/this.width-E(5)/this.width}px;`}}function p(l){return l.toString().padStart(2,"0")}class K{_htmlElement;_startTimestamp;_endTimestamp;_intervalId;constructor(e){this._htmlElement=e,this._startTimestamp=null,this._endTimestamp=null,this._intervalId=null}get htmlElement(){return this._htmlElement}get startTimestamp(){return this._startTimestamp}set startTimestamp(e){this._startTimestamp=e}get endTimestamp(){return this._endTimestamp}set endTimestamp(e){this._endTimestamp=e}get intervalId(){return this._intervalId}set intervalId(e){this._intervalId=e}get isActive(){return this.startTimestamp===null!=(this.endTimestamp===null)}get elapsedTime(){return this.startTimestamp===null?0:this.endTimestamp===null?new Date().getTime()-this.startTimestamp:this.endTimestamp-this.startTimestamp}start(){this.isActive||(this.endTimestamp=null,this.startTimestamp=new Date().getTime(),this.intervalId=setInterval(()=>this.render(),1e3))}stop(){this.isActive&&(this.endTimestamp=new Date().getTime(),this.intervalId&&clearInterval(this.intervalId),this.intervalId=null)}reset(){this.startTimestamp=null,this.endTimestamp=null,this.intervalId&&clearInterval(this.intervalId),this.render()}render(){this.htmlElement.innerHTML=this.toString()}toString(){let e=Math.round(this.elapsedTime/1e3%60),i=Math.floor(this.elapsedTime/6e4)%60,n=Math.floor(this.elapsedTime/36e5);return`${n>0?`${p(n)}:`:""}${p(i)}:${p(e)}`}}const W=document.getElementById("minefield"),q=document.getElementById("timer"),Z=document.getElementById("number-of-mines-remaining"),Q=document.getElementById("new-game-button"),g=document.getElementById("minefield-container"),h=document.getElementById("difficulty-select"),o=document.getElementById("width-input"),a=document.getElementById("height-input"),m=document.getElementById("number-of-mines-input"),x=new z(W,g,new K(q),Z);let c="NONE";const b=l=>{c==="NONE"&&(c=l,m.value==="1"||Number(m.value)===Number(o.value)*Number(a.value)-9?h.value="none":Number(m.value)/(Number(o.value)*Number(a.value))<.15625?h.value="easy":Number(m.value)/(Number(o.value)*Number(a.value))<.21875?h.value="medium":Number(m.value)/(Number(o.value)*Number(a.value))<.375?h.value="hard":h.value="impossible",c="NONE"),m.max=`${Number(o.value)*Number(a.value)-9}`};h.onchange=()=>{if(c==="NONE"){switch(c="DIFFICULTY-SELECT",h.value){case"none":o.value="8",a.value="8",m.value="1";break;case"easy":o.value="8",a.value="8",m.value="8";break;case"medium":o.value="16",a.value="16",m.value="48";break;case"hard":o.value="32",a.value="32",m.value="256";break;case"impossible":o.value="32",a.value="32",m.value="512";break}c="NONE"}m.max=`${Number(o.value)*Number(a.value)-9}`};o.onchange=()=>{b("WIDTH-INPUT")};a.onchange=()=>{b("HEIGHT-INPUT")};m.onchange=()=>{b("NUMBER-OF-MINES-INPUT")};const I=()=>{const l=Number(o.value),e=Number(a.value),i=Number(m.value);if(Number.isNaN(l)||Number.isNaN(e)||Number.isNaN(i)){console.error("NaN");return}x.newGame(l,e,i)};Q.onclick=()=>I();I();window.addEventListener("resize",()=>{x.resize(g.clientWidth,g.clientHeight)});
