(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&t(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();const v=(o,e)=>({x:E(0,o-1),y:E(0,e-1)}),E=(o,e)=>{if(o>e)throw new Error("start > end");return o=Math.round(o),e=Math.round(e),Math.floor(Math.random()*(e-o+1))+o},I=parseFloat(getComputedStyle(document.documentElement).fontSize),f=o=>o*I,A=async o=>{await new Promise(e=>setTimeout(e,o))},y="/demineur-web/assets/tile-default-Dh8Q20LU.png",M="/demineur-web/assets/tile-open-0-CrS4pPc-.png",L="/demineur-web/assets/tile-open-1-SckrNgAq.png",C="/demineur-web/assets/tile-open-2-CbT6ZeWw.png",P="/demineur-web/assets/tile-open-3-CiFI3eKm.png",F="/demineur-web/assets/tile-open-4-BtNOdLHl.png",R="/demineur-web/assets/tile-open-5-LlQTJ3PK.png",k="/demineur-web/assets/tile-open-6-BtQkAIJT.png",B="/demineur-web/assets/tile-open-7-CFmK46RT.png",G="/demineur-web/assets/tile-open-8-CXyNsnO6.png",N="/demineur-web/assets/tile-flag-DK9cqpkC.png",x="/demineur-web/assets/tile-flag-not-sure-B-KW3eDb.png",g="/demineur-web/assets/tile-flag-no-mine-Cm0K1Zw-.png",U="/demineur-web/assets/tile-mine-CRq_55oK.png",S="/demineur-web/assets/tile-mine-boom-CLZgeeVb.png",D="/demineur-web/assets/tile-shovel-xsDt0QN9.png",$="/demineur-web/assets/tile-cross-DyPziB2I.png";class H{_minefield;_mine;_state;_position;_htmlElement;_isPopupOpen;constructor(e,n,t){this._minefield=e,this._position=n,this._mine=t,this._state="DEFAULT",this._htmlElement=document.createElement("div"),this._htmlElement.id=`tile-${this.position.x}-${this.position.y}`,this._isPopupOpen=!1}get minefield(){return this._minefield}get position(){return this._position}get mine(){return this._mine}set mine(e){this._mine=e}get state(){return this._state}set state(e){this._state=e}get isPopupOpen(){return this._isPopupOpen}set isPopupOpen(e){this._isPopupOpen=e}get numberOfMinesAround(){return this.mine?0:this.minefield.getNumberOfMinesAround(this.position)}get numberOfFlagsAround(){return this.mine?0:this.minefield.getNumberOfFlagsAround(this.position)}get numberOfUnexploredTilesAround(){return this.minefield.getNumberOfUnexploredTilesAround(this.position)}get htmlElement(){return this._htmlElement}openPopup(){if(this.isPopupOpen||this.minefield.isGameOver||this.state==="OPEN"&&this.numberOfMinesAround===0)return;this.minefield.closeAllOtherPopup(this.position);const e=document.createElement("div");if(e.className="dig-popup",this.state==="DEFAULT"||this.state==="OPEN"&&this.numberOfUnexploredTilesAround>0){const s=document.createElement("button"),l=document.createElement("img");l.src=D,l.alt="Dig",s.appendChild(l),s.type="button",s.title="Dig",s.onclick=()=>this.open(),e.appendChild(s)}if(this.state!=="OPEN"){const s=document.createElement("button");if(this.state==="FLAG"){const m=document.createElement("img");m.src=g,m.alt="Remove the flag.",s.appendChild(m),s.type="button",s.title="Remove the flag.",s.onclick=()=>{this.state="DEFAULT",this.closePopup(),this.minefield.updateNumberOfMinesRemainingIndicator()}}else{const m=document.createElement("img");m.src=N,m.alt="Put a flag here.",s.appendChild(m),s.type="button",s.title="Put a flag here.",s.onclick=()=>{this.state="FLAG",this.closePopup(),this.minefield.updateNumberOfMinesRemainingIndicator()}}e.appendChild(s);const l=document.createElement("button");if(this.state==="FLAG-NOT-SURE"){const m=document.createElement("img");m.src=g,m.alt="Remove the flag.",l.appendChild(m),l.type="button",l.title="Remove the flag.",l.onclick=()=>{this.state="DEFAULT",this.closePopup()}}else{const m=document.createElement("img");m.src=x,m.alt="Put a flag with a question mark here.",l.appendChild(m),l.type="button",l.title="Put a flag with a question mark here.",l.onclick=()=>{this.state="FLAG-NOT-SURE",this.closePopup()}}e.appendChild(l)}const n=document.createElement("button"),t=document.createElement("img");t.src=$,t.alt="Close popup",n.appendChild(t),n.type="button",n.title="Close popup",n.onclick=()=>this.closePopup(),e.appendChild(n),this.htmlElement.appendChild(e),this.isPopupOpen=!0;const i=e.getBoundingClientRect(),r=this.minefield.container.getBoundingClientRect();i.left<r.left?e.classList.add("near-left-edge"):i.right>r.right&&e.classList.add("near-right-edge")}closePopup(){this.isPopupOpen&&(this.render(),this.isPopupOpen=!1)}open(){this.minefield.isGameOver||(this.minefield.firstClick&&this.minefield.handleFirstClick(this.position),this.state="OPEN",this.mine?this.minefield.gameOver(!1):(this.minefield.checkIfItsAWin(),this.numberOfFlagsAround===this.numberOfMinesAround&&this.minefield.openAdjacentTiles(this.position)),this.render())}render(){this.htmlElement.innerHTML="",this.htmlElement.className=`tile ${this.state.toLowerCase()} ${this.state!=="OPEN"||this.numberOfUnexploredTilesAround>0?"can-dig":""}`;let e=y,n="";this.minefield.isGameOver&&this.mine&&this.state==="DEFAULT"?(e=U,n="Mine"):this.minefield.isGameOver&&!this.mine&&(this.state==="FLAG"||this.state==="FLAG-NOT-SURE")?(e=g,n="There were no mines here."):this.state==="DEFAULT"?(e=y,n="Unexplored"):this.state==="FLAG"?(e=N,n="Flag"):this.state==="FLAG-NOT-SURE"?(e=x,n="There may be a mine."):this.mine?(e=S,n="A mine exploded here."):this.numberOfMinesAround===0?(e=M,n="No mines nearby."):this.numberOfMinesAround===1?(e=L,n="1 mine nearby."):this.numberOfMinesAround===2?(e=C,n="2 mines nearby."):this.numberOfMinesAround===3?(e=P,n="3 mines nearby."):this.numberOfMinesAround===4?(e=F,n="4 mines nearby."):this.numberOfMinesAround===5?(e=R,n="5 mines nearby."):this.numberOfMinesAround===6?(e=k,n="6 mines nearby."):this.numberOfMinesAround===7?(e=B,n="7 mines nearby."):this.numberOfMinesAround===8&&(e=G,n="8 mines nearby.");const t=document.createElement("img");t.src=e,t.alt=n,t.title=n,t.onclick=()=>{this.minefield.firstClick?this.open():this.openPopup()},this.htmlElement.appendChild(t)}}class z{_htmlElement;_container;_timer;_tiles;_isGameOver;_won;_firstClick;_numberOfMinesRemainingIndicator;constructor(e,n,t,i){this._htmlElement=e,this._container=n,this._tiles=[],this._isGameOver=!1,this._won=!1,this._firstClick=!0,this._timer=t,this._numberOfMinesRemainingIndicator=i}get htmlElement(){return this._htmlElement}get container(){return this._container}get timer(){return this._timer}get numberOfMinesRemainingIndicator(){return this._numberOfMinesRemainingIndicator}get tiles(){return this._tiles}set tiles(e){this._tiles=e}get width(){return this.tiles[0].length}get height(){return this.tiles.length}get isGameOver(){return this._isGameOver}set isGameOver(e){this._isGameOver=e}get won(){return this._won}set won(e){this._won=e}get firstClick(){return this._firstClick}set firstClick(e){this.firstClick&&!e&&this.timer.start(),this._firstClick=e}get numberOfMinesRemaining(){let e=0,n=0;for(const t of this.tiles)for(const i of t)i.state==="FLAG"&&n++,i.mine&&e++;return e-n}newGame(e,n,t){if(t>e*n-9)throw new Error("To much mine");const i=[];for(let r=0;r<t;r++){let s,l;do{l=!0,s=v(e,n);for(const m of i)if(m.x===s.x&&m.y===s.y){l=!1;break}}while(!l);i.push(s)}this.timer.reset(),this.isGameOver=!1,this.won=!1,this.firstClick=!0,this.tiles=[];for(let r=0;r<n;r++){const s=[];for(let l=0;l<e;l++){let m=!1;for(const T of i)if(T.x===l&&T.y===r){m=!0;break}s.push(new H(this,{x:l,y:r},m))}this._tiles.push(s)}this.htmlElement.innerHTML="";for(const r of this.tiles){const s=document.createElement("div");s.className="tile-line";for(const l of r)s.appendChild(l.htmlElement);this.htmlElement.appendChild(s)}this.updateNumberOfMinesRemainingIndicator(),this.render(),(async()=>(A(0),this.resize()))()}updateNumberOfMinesRemainingIndicator(){this.numberOfMinesRemainingIndicator.innerText=this.numberOfMinesRemaining.toString()}handleFirstClick(e){this.firstClick=!1;let n=0;for(let t=e.y-1;t<=e.y+1;t++)for(let i=e.x-1;i<=e.x+1;i++)i<0||t<0||i>this.tiles[0].length-1||t>this.tiles.length-1||this.tiles[t][i].mine&&(n++,this.tiles[t][i].mine=!1);for(let t=0;t<n;t++){let i,r;do r=!0,i=v(this.tiles[0].length,this.tiles.length),(i.x>=e.x-1&&i.x<=e.x+1&&i.y>=e.y-1&&i.y<=e.y+1||this.tiles[i.y][i.x].mine)&&(r=!1);while(!r);this.tiles[i.y][i.x].mine=!0}}gameOver(e){this.timer.stop(),this.isGameOver=!0,this.won=e,this.render()}checkIfItsAWin(){if(this.isGameOver)return;let e=0,n=0;for(const t of this.tiles)for(const i of t)i.state!=="OPEN"&&n++,i.mine&&e++;e===n&&this.gameOver(!0)}getNumberOfMinesAround(e){let n=0;for(let t=e.y-1;t<=e.y+1;t++)for(let i=e.x-1;i<=e.x+1;i++)i===e.x&&t===e.y||i<0||t<0||i>this.tiles[0].length-1||t>this.tiles.length-1||this.tiles[t][i].mine&&n++;return n}getNumberOfFlagsAround(e){let n=0;for(let t=e.y-1;t<=e.y+1;t++)for(let i=e.x-1;i<=e.x+1;i++)i===e.x&&t===e.y||i<0||t<0||i>this.tiles[0].length-1||t>this.tiles.length-1||this.tiles[t][i].state==="FLAG"&&n++;return n}getNumberOfUnexploredTilesAround(e){let n=0;for(let t=e.y-1;t<=e.y+1;t++)for(let i=e.x-1;i<=e.x+1;i++)i===e.x&&t===e.y||i<0||t<0||i>this.tiles[0].length-1||t>this.tiles.length-1||this.tiles[t][i].state==="DEFAULT"&&n++;return n}openAdjacentTiles(e){for(let n=e.y-1;n<=e.y+1;n++)for(let t=e.x-1;t<=e.x+1;t++)t===e.x&&n===e.y||t<0||n<0||t>this.tiles[0].length-1||n>this.tiles.length-1||this.tiles[n][t].state!=="DEFAULT"||this.tiles[n][t].open()}closeAllOtherPopup(e){for(const n of this.tiles)for(const t of n)t.position.x===e.x&&t.position.y===e.y||t.closePopup()}render(){this.htmlElement.className=this.isGameOver?"game-over":"";for(const e of this.tiles)for(const n of e)n.render()}resize(){const e=this.container.clientWidth/this.container.clientHeight,n=this.width/this.height;e>n?this.htmlElement.style=`--tile-size: ${this.container.clientHeight/this.height-f(5)/this.height}px;`:this.htmlElement.style=`--tile-size: ${this.container.clientWidth/this.width-f(5)/this.width}px;`;const t=this.htmlElement.getBoundingClientRect(),i=this.container.getBoundingClientRect();t.width+f(4)>i.width?this.container.classList.add("scroll-x"):this.container.classList.remove("scroll-x"),t.height+f(4)>i.height?this.container.classList.add("scroll-y"):this.container.classList.remove("scroll-y")}}function b(o){return o.toString().padStart(2,"0")}class K{_htmlElement;_startTimestamp;_endTimestamp;_intervalId;constructor(e){this._htmlElement=e,this._startTimestamp=null,this._endTimestamp=null,this._intervalId=null}get htmlElement(){return this._htmlElement}get startTimestamp(){return this._startTimestamp}set startTimestamp(e){this._startTimestamp=e}get endTimestamp(){return this._endTimestamp}set endTimestamp(e){this._endTimestamp=e}get intervalId(){return this._intervalId}set intervalId(e){this._intervalId=e}get isActive(){return this.startTimestamp===null!=(this.endTimestamp===null)}get elapsedTime(){return this.startTimestamp===null?0:this.endTimestamp===null?new Date().getTime()-this.startTimestamp:this.endTimestamp-this.startTimestamp}start(){this.isActive||(this.endTimestamp=null,this.startTimestamp=new Date().getTime(),this.intervalId=setInterval(()=>this.render(),1e3))}stop(){this.isActive&&(this.endTimestamp=new Date().getTime(),this.intervalId&&clearInterval(this.intervalId),this.intervalId=null)}reset(){this.startTimestamp=null,this.endTimestamp=null,this.intervalId&&clearInterval(this.intervalId),this.render()}render(){this.htmlElement.innerHTML=this.toString()}toString(){let e=Math.round(this.elapsedTime/1e3%60),n=Math.floor(this.elapsedTime/6e4)%60,t=Math.floor(this.elapsedTime/36e5);return`${t>0?`${b(t)}:`:""}${b(n)}:${b(e)}`}}const W=document.getElementById("minefield"),q=document.getElementById("timer"),Z=document.getElementById("number-of-mines-remaining"),Q=document.getElementById("new-game-button"),j=document.getElementById("new-game-mobile-button"),J=document.getElementById("minefield-container"),p=document.getElementById("new-game-section"),c=document.getElementById("difficulty-select"),u=document.getElementById("width-input"),h=document.getElementById("height-input"),a=document.getElementById("number-of-mines-input"),_=new z(W,J,new K(q),Z);let d="NONE";const O=o=>{d==="NONE"&&(d=o,a.value==="1"||Number(a.value)===Number(u.value)*Number(h.value)-9?c.value="none":Number(a.value)/(Number(u.value)*Number(h.value))<.15625?c.value="easy":Number(a.value)/(Number(u.value)*Number(h.value))<.21875?c.value="medium":Number(a.value)/(Number(u.value)*Number(h.value))<.375?c.value="hard":c.value="impossible",d="NONE"),a.max=`${Number(u.value)*Number(h.value)-9}`};c.onchange=()=>{if(d==="NONE"){switch(d="DIFFICULTY-SELECT",c.value){case"none":u.value="8",h.value="8",a.value="1";break;case"easy":u.value="8",h.value="8",a.value="8";break;case"medium":u.value="16",h.value="16",a.value="48";break;case"hard":u.value="32",h.value="32",a.value="256";break;case"impossible":u.value="32",h.value="32",a.value="512";break}d="NONE"}a.max=`${Number(u.value)*Number(h.value)-9}`};u.onchange=()=>{O("WIDTH-INPUT")};h.onchange=()=>{O("HEIGHT-INPUT")};a.onchange=()=>{O("NUMBER-OF-MINES-INPUT")};const w=()=>{const o=Number(u.value),e=Number(h.value),n=Number(a.value);if(Number.isNaN(o)||Number.isNaN(e)||Number.isNaN(n)){console.error("NaN");return}_.newGame(o,e,n),p.classList.remove("open")};Q.onclick=()=>w();w();window.addEventListener("resize",()=>{_.resize()});j.onclick=()=>{p.classList.contains("open")?p.classList.remove("open"):p.classList.add("open")};
